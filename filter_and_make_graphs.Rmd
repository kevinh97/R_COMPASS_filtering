---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 
```{r, startup}
library(stringr)
library(ggplot2)

df <- readRDS("master_table_UPF1_RRP6_COMPASS")
previous_SJ <- readRDS("previous_SJ")
```



```{r}
#Change the V7 formatting
df$V7 <- gsub(" ", "_", df$V7)
df$V7 <- paste("chr", df$V7)
df$V7 <- str_replace_all(df$V7, fixed(" "), "")
previous_SJ$intron_ID <- gsub(" ", "_", previous_SJ$intron_ID)
```

```{r}
#Subset
df$previously_reported <- ifelse(df$V7 %in% previous_SJ$intron_ID,"true","false")
not_in_previousSJ <- subset(df, df$previously_reported == 'false')
unannotated_introns_UR <- subset(not_in_previousSJ, not_in_previousSJ$U_R_3YPD_overlapping_annotated_intron == 'FALSE')
no_mito <- subset(df , df$V2 != "mito")
not_overlapping_intron <- subset(no_mito, no_mito$UPF1_3YPD_overlapping_annotated_intron != 'TRUE')

only_in_U_R <- subset(not_in_previousSJ, not_in_previousSJ$UPF1_3YPD_spliced_to_unspliced_ratio_each_sample != 'NA')
```

```{r}
write_csv(df, file = "master_df.csv")

write_csv(unannotated_introns_UR, file = "unannotated_introns_list.csv")

write_csv()
```

```{r}
#Average spliced to unspliced ratios
df$RRP6_1_YPD_spliced_to_unspliced_ratio<- as.numeric(df$RRP6_1_YPD_spliced_to_unspliced_ratio)

df$RRP6_2YPD_spliced_to_unspliced_ratio <- as.numeric(df$RRP6_2YPD_spliced_to_unspliced_ratio)

df$RRP6_3YPD_spliced_to_unspliced_ratio <- as.numeric(df$RRP6_3YPD_spliced_to_unspliced_ratio)

df$UPF1_1_YPD_spliced_to_unspliced_ratio<- as.numeric(df$UPF1_1_YPD_spliced_to_unspliced_ratio)

df$UPF1_2YPD_spliced_to_unspliced_ratio <- as.numeric(df$UPF1_2YPD_spliced_to_unspliced_ratio)

df$UPF1_3YPD_spliced_to_unspliced_ratio <- as.numeric(df$UPF1_3YPD_spliced_to_unspliced_ratio)

df$U_R_1YPD_spliced_to_unspliced_ratio<- as.numeric(df$U_R_1YPD_spliced_to_unspliced_ratio)

df$U_R_2YPD_spliced_to_unspliced_ratio <- as.numeric(df$U_R_2YPD_spliced_to_unspliced_ratio)

df$U_R_3YPD_spliced_to_unspliced_ratio <- as.numeric(df$U_R_3YPD_spliced_to_unspliced_ratio)

df$U_R_3YPD_FAnS <- as.numeric(df$U_R_3YPD_FAnS)

df$U_R_2YPD_FAnS <- as.numeric(df$U_R_2YPD_FAnS)

df$U_R_1YPD_FAnS <- as.numeric(df$U_R_1YPD_FAnS)

df$UPF1_3YPD_FAnS <- as.numeric(df$UPF1_3YPD_FAnS)

df$UPF1_2YPD_FAnS <- as.numeric(df$UPF1_2YPD_FAnS)

df$UPF1_1_YPD_FAnS <- as.numeric(df$UPF1_1_YPD_FAnS)

df$RRP6_3YPD_FAnS <- as.numeric(df$RRP6_3YPD_FAnS)

df$RRP6_2YPD_FAnS <- as.numeric(df$RRP6_2YPD_FAnS)

df$RRP6_1_YPD_FAnS <- as.numeric(df$RRP6_1_YPD_FAnS)

df$RRP6Mean_spliced_to_unspliced <- rowMeans( df[c('RRP6_1_YPD_spliced_to_unspliced_ratio', 'RRP6_2YPD_spliced_to_unspliced_ratio', 'RRP6_3YPD_spliced_to_unspliced_ratio')], na.rm = TRUE)

df$UPF1Mean_spliced_to_unspliced <- rowMeans( df[c('UPF1_1_YPD_spliced_to_unspliced_ratio', 'UPF1_2YPD_spliced_to_unspliced_ratio', 'UPF1_3YPD_spliced_to_unspliced_ratio')], na.rm = TRUE)

df$U_R_Mean_spliced_to_unspliced <- rowMeans( df[c('U_R_1YPD_spliced_to_unspliced_ratio', 'U_R_2YPD_spliced_to_unspliced_ratio', 'U_R_3YPD_spliced_to_unspliced_ratio')], na.rm = TRUE)

df$RRP6Mean_FAnS <- rowMeans( df[c('RRP6_1_YPD_FAnS', 'RRP6_2YPD_FAnS', 'RRP6_3YPD_FAnS')], na.rm = TRUE)

df$UPF1Mean_FAnS <- rowMeans( df[c('UPF1_1_YPD_FAnS', 'UPF1_2YPD_FAnS', 'UPF1_3YPD_FAnS')], na.rm = TRUE)

df$U_R_Mean_FAnS <- rowMeans( df[c('U_R_1YPD_FAnS', 'U_R_2YPD_FAnS', 'U_R_3YPD_FAnS')], na.rm = TRUE)

#df$ones_with_0SE <- ifelse($intron_ID %in% rrp6$intron_ID,"true","false")

#df$RRP6Mean_FAnS_SE <- summarize(Ave = df$RRP6Mean_FAnS, SE = sd(RRP6Mean_FAnS)/sqrt(3))

```

```{r}
#Trying to make venn diagrams to compare knockouts and replicates >.<
combined_tbl %>% group_by(sample_prefix) %>%
  ggVennDiagram()

#ggVennDiagram(df[c('U_R_1YPD_sample_prefix', 'U_R_2YPD_sample_prefix', 'U_R_3YPD_sample_prefix')])
```

```{r}
test_graph <- ggplot(data = df)+
  geom_point(aes(x = as.numeric(U_R_Mean_FAnS), y = as.numeric(UPF1Mean_FAnS), color = U_R_3YPD_overlapping_RPG_annotated_intron))+
  scale_x_log10()+
  scale_y_log10()+
    labs(title = "FAnS comparision of UPF1∆RRP6∆ vs UPF1∆") +
  xlab("UPF1∆RRP6∆ FAnS") +
  ylab("UPF1∆ FAnS")+
  labs(colour = "Overlapping RPG annotated intron")+ 
  #geom_text(aes(x = U_R_Mean_FAnS, y = UPF1Mean_FAnS ,label=df$V7), check_overlap = TRUE) +
  #geom_hline(yintercept = 1)+
  #geom_vline(xintercept = 1)+
  geom_abline(slope = 1)


ggplot(data = df)+
  geom_point(aes(x = as.numeric(U_R_Mean_FAnS), y = as.numeric(RRP6Mean_FAnS), color = U_R_3YPD_overlapping_RPG_annotated_intron))+
  scale_x_log10()+
  scale_y_log10()+
    labs(title = "FAnS comparision of UPF1∆RRP6∆ vs RRP6∆") +
  xlab("UPF1∆RRP6∆ FAnS") +
  ylab("RRP6∆ FAnS")+
  labs(colour = "Overlapping RPG annotated intron")+
  #geom_hline(yintercept = 1)+
  #geom_vline(xintercept = 1)+
  geom_abline(slope = 1)

ggplot(data = df)+
  geom_point(aes(x = as.numeric(RRP6Mean_FAnS), y = as.numeric(UPF1Mean_FAnS), color = U_R_3YPD_overlapping_RPG_annotated_intron))+
  scale_x_log10()+
  scale_y_log10()+
    labs(title = "FAnS comparision of RRP6∆ vs UPF1∆") +
  xlab("RRP6∆ FAnS") +
  ylab("UPF1∆ FAnS")+
  labs(colour = "Overlapping RPG annotated intron")+
  #geom_hline(yintercept = 1)+
  #geom_vline(xintercept = 1)+
  geom_abline(slope = 1)
```

```{r}
#Make some plots
ggplot(data = no_mito)+
  geom_point(aes(x = as.numeric(U_R_Mean_spliced_to_unspliced), y = as.numeric(UPF1Mean_spliced_to_unspliced), color = U_R_3YPD_overlapping_RPG_annotated_intron))+
  scale_x_log10()+
  scale_y_log10()+
    labs(title = "Splice to Unspliced comparision of UPF1∆RRP6∆ vs UPF1∆") +
  xlab("UPF1∆RRP6∆ Spliced to Unspliced") +
  ylab("UPF1∆ Spliced to Unspliced")+
  labs(colour = "Overlapping RPG annotated intron")+
  #geom_hline(yintercept = 1)+
  #geom_vline(xintercept = 1)+
  geom_abline(slope = 1)

ggplot(data = no_mito)+
  geom_point(aes(x = as.numeric(U_R_Mean_spliced_to_unspliced), y = as.numeric(RRP6Mean_spliced_to_unspliced), color = U_R_3YPD_overlapping_RPG_annotated_intron))+
  scale_x_log10()+
  scale_y_log10()+
    labs(title = "Splice to Unspliced comparision of UPF1∆RRP6∆ vs RRP6∆") +
  xlab("UPF1∆RRP6∆ Spliced to Unspliced") +
  ylab("RRP6∆ Spliced to Unspliced")+
  labs(colour = "Overlapping RPG annotated intron")+
  #geom_hline(yintercept = 1)+
  #geom_vline(xintercept = 1)+
  geom_abline(slope = 1)

ggplot(data = no_mito)+
  geom_point(aes(x = as.numeric(RRP6Mean_spliced_to_unspliced), y = as.numeric(UPF1Mean_spliced_to_unspliced), color = U_R_3YPD_overlapping_RPG_annotated_intron))+
  scale_x_log10()+
  scale_y_log10()+
    labs(title = "Splice to Unspliced comparision of RRP6∆ vs UPF1∆") +
  xlab("RRP6∆ Spliced to Unspliced") +
  ylab("UPF1∆ Spliced to Unspliced")+
  labs(colour = "Overlapping RPG annotated intron")+
  #geom_hline(yintercept = 1)+
  #geom_vline(xintercept = 1)+
  geom_abline(slope = 1)
```

```{r}
ggplot(data = not_in_previousSJ)+
  geom_point(aes(x = as.numeric(U_R_3YPD_spliced_to_unspliced_ratio_each_sample), y = as.numeric(UPF1_3YPD_spliced_to_unspliced_ratio_each_sample), color = U_R_3YPD_overlapping_RPG_annotated_intron))+
  scale_x_log10()+
  scale_y_log10()+
  labs(title = "Splice to Unspliced comparision of UPF1∆RRP6∆ vs UPF1∆") +
  xlab("UPF1∆RRP6∆ Spliced to Unspliced") +
  ylab("UPF1∆ Spliced to Unspliced")+
  labs(colour = "Overlapping RPG annotated intron")+
  geom_abline(slope = 1)

ggplot(data = not_in_previousSJ)+
  geom_point(aes(x = as.numeric(U_R_3YPD_COMPASS_counts), y = as.numeric(UPF1_3YPD_COMPASS_counts), color = U_R_3YPD_overlapping_RPG_annotated_intron))+
  #scale_x_log10()+
  #scale_y_log10()+
  labs(title = "Counts comparision of UPF1∆RRP6∆ vs UPF1∆") +
  xlab("UPF1∆RRP6∆ COMPASS counts") +
  ylab("UPF1∆ COMPASS counts")+
  labs(colour = "Overlapping RPG annotated intron")+
  geom_abline(slope = 1)

ggplot(data = not_in_previousSJ)+
  geom_point(aes(x = as.numeric(U_R_3YPD_COMPASS_counts), y = as.numeric(U_R_2YPD_COMPASS_counts), color = U_R_3YPD_overlapping_RPG_annotated_intron))+
  #scale_x_log10()+
  #scale_y_log10()+
  labs(title = "Counts comparision of UPF1∆RRP6∆ replicates") +
  xlab("UPF1∆RRP6∆_3 COMPASS counts") +
  ylab("UPF1∆RRP6∆_2 COMPASS counts")+
  labs(colour = "Overlapping RPG annotated intron")+
  geom_abline(slope = 1)

ggplot(data = not_in_previousSJ)+
  geom_point(aes(x = as.numeric(U_R_3YPD_COMPASS_counts), y = as.numeric(U_R_1YPD_COMPASS_counts), color = U_R_3YPD_overlapping_RPG_annotated_intron))+
  #scale_x_log10()+
  #scale_y_log10()+
  labs(title = "Counts comparision of UPF1∆RRP6∆ replicates") +
  xlab("UPF1∆RRP6∆_3 COMPASS counts") +
  ylab("UPF1∆RRP6∆_1 COMPASS counts")+
  labs(colour = "Overlapping RPG annotated intron")+
  geom_abline(slope = 1)
```

```{r}
ggplot(data = no_mito)+
  geom_point(aes(x = as.numeric(RRP6_3YPD_spliced_to_unspliced_ratio_each_sample), y = as.numeric(UPF1_3YPD_spliced_to_unspliced_ratio_each_sample), color = U_R_3YPD_overlapping_RPG_annotated_intron))+
  scale_x_log10()+
  scale_y_log10()+
  #geom_hline(yintercept = 1)+
  #geom_vline(xintercept = 1)+
  geom_abline(slope = 1)
```

```{r}
combined_tbl$intron_ID <- str_replace_all(combined_tbl$intron_ID, fixed(" "), "")
```


```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

